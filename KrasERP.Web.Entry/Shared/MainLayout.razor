@using KrasERP.Core.SeedDatas;
@using KrasERP.Web.Entry.Componts;
@using KrasERP.Web.Entry.Models;
@using Newtonsoft.Json.Linq;
@inherits LayoutComponentBase

<div class="page">
    <div class="sidebar">
        <NavMenu childComponent="TabSet" />
    </div>
    <Button Icon="fa-solid fa-circle-plus" OnClick="@(() => AddSearchGridTab(ItemTypeInfoSeedData.ItemTypeID))" Text="添加">
    </Button>
    <div class="main">
        @*      <div class="top-row px-4">
        <a href="https://docs.microsoft.com/aspnet/" target="_blank">About</a>
        </div>*@

        <div class="content px-4">
            <Tab IsBorderCard="true" Placement="Placement.Top" @ref="TabSet" IsLazyLoadTabItem="true" >

            </Tab>
            @*    <TabCompont @ref="TabTop">
            </TabCompont>
            <KrasERP.Web.Entry.Pages.Index childComponent="TabTop"></KrasERP.Web.Entry.Pages.Index>*@
        </div> 
    </div>
</div>
@code {
    public Tab TabSet;
    public Task AddSearchGridTab(Guid ItemTypeID)
    {
        System.Console.WriteLine("MainLayout:AddSearchGridTab");
        var text = $"Tab {TabSet.Items.Count() + 1}";
        var tabTitle = text;// "";
        var context = "";
        var icon = "";
        //var formRender=
        var i = 0;
        TabSet.AddTab(new Dictionary<string, object?>
            {
                [nameof(TabItem.Icon)] = icon,
                [nameof(TabItem.Text)] = tabTitle,
                //[nameof(TabItem.IsActive)] = true,
                [nameof(TabItem.ChildContent)] = new RenderFragment((builder) =>
                {
                    builder.OpenComponent<MainGrid>(0);
                    builder.AddAttribute(i++, "itemTypeId", ItemTypeInfoSeedData.ItemTypeID);
                    builder.AddAttribute(i++, "AddFormTab", AddFormTab);
                    builder.AddAttribute(i++, "TabSet", TabSet);
                    builder.CloseComponent();
                })
            });
        return Task.CompletedTask;
    }

    public Task AddFormTab(CustomDynamicColumnsObjectData item, JArray BasePropertys)
    {
        System.Console.WriteLine("MainLayout:AddFormTab");
        var text = $"Tab {TabSet.Items.Count() + 1}";
        var tabTitle = text;// "";
        var context = "";
        var icon = "";
        //var formRender=
        var i = 0;
        TabSet.AddTab(new Dictionary<string, object?>
            {
                [nameof(TabItem.Icon)] = icon,
                [nameof(TabItem.Text)] = tabTitle,
                //[nameof(TabItem.IsActive)] = true,
                [nameof(TabItem.ChildContent)] = new RenderFragment((builder) =>
               {
                   builder.OpenComponent<FormCompont>(0);
                   builder.AddAttribute(i++, "ItemTypeID", Guid.Parse(item.Fix));
                   builder.AddAttribute(i++, "Item", item);
                   builder.AddAttribute(i++, "BasePropertys", BasePropertys);
                   builder.CloseComponent();
               }),

            });

        return Task.CompletedTask;
    }

}
